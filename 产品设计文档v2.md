AI自律系统 产品需求文档（PRD）v2.0

一、系统使命（愿景与目标）

本系统旨在构建一个“可被监督、易于使用、具备陪伴感、能够促进行为持续性”的 AI 自律引擎。强调行为完成本身的可视化与被记录，而不是内容管理。

目标定位：
- 打造一个低门槛、高反馈的任务监督系统
- 用户在最少操作下完成任务生成，系统自动追踪其执行状况
- 通过数据反馈与情绪陪伴增强长期使用意愿

二、核心原则（产品设计三条线）

1. 操作极简：一句自然语言添加任务，AI自动结构化解析。
2. 结构清晰：所有任务抽象为统一四元模型（时间+完成+重复+追踪）。
3. 数据完整：所有行为被系统显式、隐式或引导式记录。

三、任务结构四元模型

- start_mode：任务开始时间类型（flexible / fixed / point）
- complete_mode：完成判定标准（duration / count / binary）
- repeat_mode：是否重复执行（one_time / recurring）
- track_mode：如何确认完成情况（auto / user_mark / ai_query）

示例：
```json
{
  "title": "写论文",
  "start_time": "2025-05-30T10:30",
  "duration_minutes": 90,
  "start_mode": "fixed_start",
  "complete_mode": "duration_based",
  "repeat_mode": "one_time",
  "track_mode": "ai_query_required"
}
```

四、任务生成流程

- 用户输入：“明天早上锻炼1小时”
- 系统AI解析 → 补全必要字段 → 用户确认保存 → 写入任务表

五、任务主界面与执行逻辑

- 核心为 24 小时纵向时间轴
- 当前时间以红色指针显示
- 各任务按持续时间块显示，高度与时长对应，空白区域留白
- 点击任务展开详情：完成/编辑/说明放弃原因
- 到时间由 AI 提醒或弹窗提示

六、行为记录方式

| 方式 | 说明 |
|------|------|
| 显式记录 | 用户填写字段：时间、标题等 |
| 隐式记录 | 系统捕捉任务执行/拖延/修改等行为痕迹 |
| 引导记录 | AI任务后询问：“今天顺利吗？”“遇到什么问题？” |

七、数据与隐私策略

- 所有任务初期以 JSON/SQLite 本地储存
- 后期支持多端同步，将通过加密协议同步至云端（用户可选）
- 系统默认仅保存在用户设备，无需联网运行

八、用户中止与退出机制

- 所有任务均允许中止（需提供原因）
- 系统记录中止频率与原因，纳入自律指数与懒惰评分中

九、模块划分与系统解耦说明

各模块目标为保持独立性，便于后期功能插拔、重构、AI模型替换：

| 模块 | 职责说明 |
|------|-----------|
| 前端显示 | 展示任务与时间轴，记录交互行为 |
| 任务解析器 | 接收自然语言 → 输出结构化计划 |
| 存储引擎 | 管理 JSON/SQLite 任务与日志数据 |
| 任务调度器 | 定时检查任务状态并推送提醒 |
| AI陪伴引擎 | 实现追问 / 引导式反馈 / 语气生成 |
| 成就统计系统 | 日周月分析、自律指数成就生成 |

十、产品迭代路线（阶段目标）

| 版本 | 内容 |
|--------|--------|
| v1.0 | 时间轴UI + 手动添加 + JSON存储 |
| v1.1 | 接入语义解析AI，生成结构化任务 |
| v1.2 | 增加AI提醒与任务追踪机制 |
| v1.3 | 实现任务分析模块（完成率/懒惰记录） |
| v1.5 | 用户自定义AI人格与语气风格 |

十一、可选扩展模块（暂不纳入当前开发）

- 成就系统（连续完成N天、挑战任务达成） 登山 重复性  记录 日记之类的
- 自律排行榜（局域排名或公开群组）
- 拟人语气引擎（根据人格模板选择风格互动）
- AI语音支持与动态角色外观
- 积分商城与换肤机制
- 插件生态（主题训练营、减脂计划、正念引导等）
- 与其他App互通（跳转训记、多邻国同步、Notion协同）

十二、后续任务清单

- 时间轴滑动界面优化 + 点击任务弹窗模块开发
- AI任务解析prompt库建设 + 模型部署测试
- 自律指数评分设计标准化 + 动态评价公式
- 用户反馈记录系统（懒惰原因、情绪趋势）
- 任务生成流程图 + 成就展示草图输出

-- EOF --

pyqt小窗

ai_self_discipline/
├── main.py                     # 🧠 启动 PyQt 小窗，未来可替换为前端入口（Electron）
│
├── core/                       # 🎯 逻辑核心模块（未来后端也可共用）
│   ├── models/                 # 数据结构（四元任务模型等）
│   │   └── task.py
│   ├── logic/                  # 任务处理逻辑（排序、筛选、评分）
│   │   └── task_manager.py
│   └── scheduler/              # 定时调度逻辑（提醒判断等）
│       └── timer.py
│
├── storage/                    # 💾 数据读写接口（封装实际存储方案）
│   ├── json_store.py           # 当前使用本地 JSON
│   └── api_adapter.py          # 未来切换为 REST API 的替代方案
│
├── ui/                         # 🪟 桌面展示层（PyQt UI）
│   ├── window.py               # 主窗口类
│   ├── task_card.py            # 时间轴任务展示
│   └── add_task_dialog.py      # 添加任务弹窗
│
├── ai/                         # 🤖 AI模块（支持通义灵码/外部模型）
│   ├── nlp_parser.py           # 任务语义理解
│   ├── tone_generator.py       # 拟人语气生成
│   └── planner.py              # 可选：自动日程推荐
│
├── api_server/                 # 🌐 预留后端服务接口（未来FastAPI后端部署）
│   ├── main.py                 # 启动入口（仅开发/部署阶段用）
│   └── routes/
│       ├── tasks.py            # /tasks CRUD 接口
│       └── stats.py            # /stats 统计接口
│
├── assets/                     # 📁 静态资源与存档数据
│   └── tasks.json              # 当前任务数据文件（仅本地使用）
│
├── utils/                      # 🔧 通用工具库
│   └── time_utils.py
│
├── screenshots/                # 📸 比赛用运行截图与日志
│
├── README.md                   # 📄 项目说明文档
└── requirements.txt            # 📦 Python依赖项（支持PyQt + FastAPI等）

📌 分层说明（为何这么设计）
分层/模块	当前功能	后期迁移/替换	演化方向
core/	所有与 UI/存储无关的核心逻辑	可直接移至后端服务/移动端 SDK	逻辑即服务（LoS）
storage/	当前是本地 JSON	替换为 REST API / SQLite	数据即服务（DoS）
ui/	当前是 PyQt	替换为 Electron / Flutter	UI层可完全替换
ai/	通义灵码 + 本地推理	改为远程大模型 API / 自托管模型	模型即服务（MoS）
api_server/	当前空壳	后期开发部署接口服务	支撑多端同步与协同
assets/	本地静态	后期仅作缓存	可接入 CDN 或云存储

🌉 长期演化路线建议
阶段	技术形式	功能目标
✅ 桌面 v1.0	PyQt 小窗 + JSON本地	快速迭代原型，形成初步可用体验
🔁 桌面 v2.0	PyQt + 本地 API 接口	前后端分离结构雏形（Flask/FastAPI）
🌐 多端 v3.0	前端（Vue/React）+ 后端（FastAPI）+ SQLite/MySQL	支持 Web、小程序、手机 App
☁️ 云端同步	后端接入 WebSocket + 云存储	支持跨设备同步、自律指数云统计
👥 用户体系	OAuth / JWT 登录	支持多人使用、自定义 AI 角色、排行榜等社交机制